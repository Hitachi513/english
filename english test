<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上英文能力檢測系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .question {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .options {
            margin-left: 20px;
        }
        .option {
            margin-bottom: 10px;
        }
        .hidden {
            display: none;
        }
        .result {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            padding: 20px;
            background-color: #e9f7ef;
            border-radius: 5px;
        }
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .timer {
            text-align: right;
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 登入頁面 -->
        <div id="login-page">
            <h1>線上英文能力檢測系統</h1>
            <div class="form-group">
                <label for="verification-code">驗證碼</label>
                <input type="text" id="verification-code" placeholder="請輸入驗證碼">
            </div>
            <div class="form-group">
                <label for="question-count">選擇題數</label>
                <select id="question-count">
                    <option value="50">50題</option>
                    <option value="80">80題</option>
                    <option value="100">100題</option>
                    <option value="150">150題</option>
                    <option value="200">200題</option>
                    <option value="250">250題</option>
                </select>
            </div>
            <button id="start-test">開始測驗</button>
        </div>

        <!-- 測驗頁面 -->
        <div id="test-page" class="hidden">
            <div class="timer" id="timer">剩餘時間: 60:00</div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div id="questions-container"></div>
            <button id="submit-test" class="hidden">提交測驗</button>
        </div>

        <!-- 結果頁面 -->
        <div id="result-page" class="hidden">
            <h1>測驗結果</h1>
            <div class="result" id="result-level"></div>
            <div id="score-details"></div>
            <button id="restart-test">重新測驗</button>
        </div>
    </div>

    <script>
        // 題庫 (300題)
        const questionBank = [
            // 語法題 (150題)
            { question: "She ___ to the store every morning.", options: ["go", "goes", "going", "gone"], answer: 1, category: "grammar" },
            { question: "If it rains, we ___ cancel the picnic.", options: ["will", "would", "should", "shall"], answer: 0, category: "grammar" },
            { question: "By next year, I ___ here for five years.", options: ["will work", "will have worked", "have worked", "worked"], answer: 1, category: "grammar" },
            { question: "He asked me ___ I was going to the party.", options: ["if", "that", "whether", "both a and c"], answer: 3, category: "grammar" },
            { question: "The book ___ on the table belongs to me.", options: ["lying", "lays", "lie", "laid"], answer: 0, category: "grammar" },
            { question: "Neither John nor his friends ___ coming to the party.", options: ["is", "are", "was", "has"], answer: 1, category: "grammar" },
            { question: "She suggested that he ___ a doctor.", options: ["see", "sees", "saw", "seen"], answer: 0, category: "grammar" },
            { question: "I wish I ___ how to swim when I was younger.", options: ["learned", "had learned", "would learn", "learn"], answer: 1, category: "grammar" },
            { question: "The more you practice, ___ you become.", options: ["the better", "better", "the best", "best"], answer: 0, category: "grammar" },
            { question: "It's high time you ___ to bed.", options: ["go", "went", "gone", "going"], answer: 1, category: "grammar" },
            { question: "She ___ her homework before she went out to play.", options: ["finished", "had finished", "has finished", "was finishing"], answer: 1, category: "grammar" },
            { question: "This is the house ___ Jack built.", options: ["which", "where", "that", "whose"], answer: 2, category: "grammar" },
            { question: "I ___ my keys. Can you help me look for them?", options: ["lost", "have lost", "had lost", "lose"], answer: 1, category: "grammar" },
            { question: "By the time we arrived, the movie ___.", options: ["already started", "had already started", "has already started", "was already starting"], answer: 1, category: "grammar" },
            { question: "If I ___ you, I would apologize.", options: ["am", "were", "had been", "will be"], answer: 1, category: "grammar" },
            { question: "The teacher made the students ___ the assignment again.", options: ["do", "to do", "doing", "done"], answer: 0, category: "grammar" },
            { question: "Not only the students but also the teacher ___ excited about the trip.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "I look forward to ___ from you soon.", options: ["hear", "hearing", "heard", "have heard"], answer: 1, category: "grammar" },
            { question: "She is one of those people who ___ always on time.", options: ["is", "are", "was", "were"], answer: 1, category: "grammar" },
            { question: "Had I known about the problem, I ___ helped.", options: ["would have", "will have", "had", "would"], answer: 0, category: "grammar" },
            { question: "The committee ___ divided in their opinions.", options: ["is", "are", "was", "were"], answer: 1, category: "grammar" },
            { question: "I'd rather you ___ here with me now.", options: ["stay", "stayed", "have stayed", "will stay"], answer: 1, category: "grammar" },
            { question: "No sooner ___ the phone rang than the doorbell rang too.", options: ["did", "had", "has", "was"], answer: 1, category: "grammar" },
            { question: "The news ___ shocking to everyone.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "Scarcely ___ sat down when the phone rang.", options: ["I had", "had I", "I have", "have I"], answer: 1, category: "grammar" },
            { question: "Ten dollars ___ a high price to pay for a cup of coffee.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "It's no use ___ about the past.", options: ["to cry", "crying", "cry", "cried"], answer: 1, category: "grammar" },
            { question: "The police ___ investigating the crime.", options: ["is", "are", "was", "has"], answer: 1, category: "grammar" },
            { question: "I object to ___ treated like this.", options: ["being", "be", "been", "have been"], answer: 0, category: "grammar" },
            { question: "Hardly ___ left the house when it started to rain.", options: ["I had", "had I", "I have", "have I"], answer: 1, category: "grammar" },
            
            // 更多語法題...
            { question: "She ___ her keys at home yesterday.", options: ["forget", "forgot", "forgotten", "forgetting"], answer: 1, category: "grammar" },
            { question: "By this time next year, I ___ my degree.", options: ["will complete", "will have completed", "complete", "have completed"], answer: 1, category: "grammar" },
            { question: "The movie was ___ than I expected.", options: ["more interesting", "most interesting", "interestinger", "interesting"], answer: 0, category: "grammar" },
            { question: "If he ___ harder, he would have passed the exam.", options: ["studied", "had studied", "would study", "studies"], answer: 1, category: "grammar" },
            { question: "She asked me ___ I could help her with the project.", options: ["if", "that", "whether", "both a and c"], answer: 3, category: "grammar" },
            { question: "The children ___ playing in the garden when it started to rain.", options: ["were", "was", "are", "is"], answer: 0, category: "grammar" },
            { question: "I ___ my phone before I realized it was in my pocket.", options: ["had searched", "searched", "have searched", "was searching"], answer: 0, category: "grammar" },
            { question: "Not only the students but also the teacher ___ excited about the trip.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "She suggested that he ___ a doctor.", options: ["see", "sees", "saw", "seen"], answer: 0, category: "grammar" },
            { question: "I wish I ___ how to swim when I was younger.", options: ["learned", "had learned", "would learn", "learn"], answer: 1, category: "grammar" },
            { question: "The more you practice, ___ you become.", options: ["the better", "better", "the best", "best"], answer: 0, category: "grammar" },
            { question: "It's high time you ___ to bed.", options: ["go", "went", "gone", "going"], answer: 1, category: "grammar" },
            { question: "She ___ her homework before she went out to play.", options: ["finished", "had finished", "has finished", "was finishing"], answer: 1, category: "grammar" },
            { question: "This is the house ___ Jack built.", options: ["which", "where", "that", "whose"], answer: 2, category: "grammar" },
            { question: "I ___ my keys. Can you help me look for them?", options: ["lost", "have lost", "had lost", "lose"], answer: 1, category: "grammar" },
            { question: "By the time we arrived, the movie ___.", options: ["already started", "had already started", "has already started", "was already starting"], answer: 1, category: "grammar" },
            { question: "If I ___ you, I would apologize.", options: ["am", "were", "had been", "will be"], answer: 1, category: "grammar" },
            { question: "The teacher made the students ___ the assignment again.", options: ["do", "to do", "doing", "done"], answer: 0, category: "grammar" },
            { question: "Not only the students but also the teacher ___ excited about the trip.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "I look forward to ___ from you soon.", options: ["hear", "hearing", "heard", "have heard"], answer: 1, category: "grammar" },
            { question: "She is one of those people who ___ always on time.", options: ["is", "are", "was", "were"], answer: 1, category: "grammar" },
            { question: "Had I known about the problem, I ___ helped.", options: ["would have", "will have", "had", "would"], answer: 0, category: "grammar" },
            { question: "The committee ___ divided in their opinions.", options: ["is", "are", "was", "were"], answer: 1, category: "grammar" },
            { question: "I'd rather you ___ here with me now.", options: ["stay", "stayed", "have stayed", "will stay"], answer: 1, category: "grammar" },
            { question: "No sooner ___ the phone rang than the doorbell rang too.", options: ["did", "had", "has", "was"], answer: 1, category: "grammar" },
            { question: "The news ___ shocking to everyone.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "Scarcely ___ sat down when the phone rang.", options: ["I had", "had I", "I have", "have I"], answer: 1, category: "grammar" },
            { question: "Ten dollars ___ a high price to pay for a cup of coffee.", options: ["is", "are", "were", "have been"], answer: 0, category: "grammar" },
            { question: "It's no use ___ about the past.", options: ["to cry", "crying", "cry", "cried"], answer: 1, category: "grammar" },
            { question: "The police ___ investigating the crime.", options: ["is", "are", "was", "has"], answer: 1, category: "grammar" },
            { question: "I object to ___ treated like this.", options: ["being", "be", "been", "have been"], answer: 0, category: "grammar" },
            { question: "Hardly ___ left the house when it started to rain.", options: ["I had", "had I", "I have", "have I"], answer: 1, category: "grammar" },
            
            // 詞彙題 (100題)
            { question: "What is the synonym of 'benevolent'?", options: ["Kind", "Angry", "Stubborn", "Dishonest"], answer: 0, category: "vocabulary" },
            { question: "The word 'ephemeral' means:", options: ["Lasting a very short time", "Extremely large", "Very expensive", "Highly intelligent"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Accomodate", "Acommodate", "Accommodate", "Acomodate"], answer: 2, category: "vocabulary" },
            { question: "What is the antonym of 'arduous'?", options: ["Difficult", "Easy", "Long", "Short"], answer: 1, category: "vocabulary" },
            { question: "The word 'ubiquitous' means:", options: ["Rare", "Present everywhere", "Expensive", "Invisible"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'pragmatic'?", options: ["Dealing with things sensibly", "Highly emotional", "Extremely religious", "Very artistic"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Definately", "Definitely", "Definately", "Definitaly"], answer: 1, category: "vocabulary" },
            { question: "What is the synonym of 'verbose'?", options: ["Wordy", "Quiet", "Angry", "Happy"], answer: 0, category: "vocabulary" },
            { question: "The word 'alacrity' means:", options: ["Eagerness", "Sadness", "Fear", "Anger"], answer: 0, category: "vocabulary" },
            { question: "What is the antonym of 'meticulous'?", options: ["Careful", "Careless", "Happy", "Sad"], answer: 1, category: "vocabulary" },
            { question: "The word 'gregarious' describes someone who is:", options: ["Shy", "Sociable", "Angry", "Intelligent"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'quintessential'?", options: ["Representing the perfect example", "Very large", "Extremely old", "Highly unusual"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Occasion", "Ocassion", "Occassion", "Ocasion"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'enervate'?", options: ["Energize", "Weaken", "Anger", "Please"], answer: 1, category: "vocabulary" },
            { question: "The word 'iconoclast' refers to someone who:", options: ["Attacks cherished beliefs", "Creates icons", "Worships idols", "Paints pictures"], answer: 0, category: "vocabulary" },
            { question: "What is the antonym of 'prolific'?", options: ["Productive", "Unproductive", "Happy", "Sad"], answer: 1, category: "vocabulary" },
            { question: "The word 'sycophant' means:", options: ["A flatterer", "A brave person", "A wise person", "A lazy person"], answer: 0, category: "vocabulary" },
            { question: "What is the meaning of 'zeitgeist'?", options: ["The spirit of the time", "A type of music", "A German car", "A philosophical concept"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Embarrass", "Embarass", "Embaras", "Embarras"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'loquacious'?", options: ["Quiet", "Talkative", "Angry", "Happy"], answer: 1, category: "vocabulary" },
            { question: "The word 'obfuscate' means:", options: ["To clarify", "To confuse", "To decorate", "To celebrate"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'banal'?", options: ["Commonplace", "Original", "Boring", "Interesting"], answer: 1, category: "vocabulary" },
            { question: "The word 'perspicacious' describes someone who is:", options: ["Stupid", "Shrewd", "Angry", "Happy"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'serendipity'?", options: ["The occurrence of happy accidents", "A type of fruit", "A scientific method", "A musical instrument"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Separate", "Seperate", "Separete", "Seprate"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'equivocate'?", options: ["To speak clearly", "To be ambiguous", "To shout", "To whisper"], answer: 1, category: "vocabulary" },
            { question: "The word 'recalcitrant' means:", options: ["Obedient", "Stubbornly resistant", "Happy", "Sad"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'esoteric'?", options: ["Obscure", "Common", "Difficult", "Easy"], answer: 1, category: "vocabulary" },
            { question: "The word 'fastidious' describes someone who is:", options: ["Very demanding", "Very lazy", "Very happy", "Very sad"], answer: 0, category: "vocabulary" },
            
            // 更多詞彙題...
            { question: "What is the meaning of 'ostentatious'?", options: ["Showy", "Modest", "Quiet", "Simple"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Necessary", "Neccessary", "Necesary", "Neccesary"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'placate'?", options: ["Anger", "Pacify", "Excite", "Ignore"], answer: 1, category: "vocabulary" },
            { question: "The word 'precipitous' means:", options: ["Gradual", "Steep", "Flat", "Wide"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'prosaic'?", options: ["Ordinary", "Poetic", "Boring", "Dull"], answer: 1, category: "vocabulary" },
            { question: "The word 'querulous' describes someone who is:", options: ["Happy", "Complaining", "Quiet", "Energetic"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'sanguine'?", options: ["Optimistic", "Pessimistic", "Angry", "Sad"], answer: 0, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Privilege", "Privledge", "Privilege", "Priviledge"], answer: 2, category: "vocabulary" },
            { question: "What is the synonym of 'taciturn'?", options: ["Talkative", "Quiet", "Angry", "Happy"], answer: 1, category: "vocabulary" },
            { question: "The word 'ubiquitous' means:", options: ["Rare", "Present everywhere", "Expensive", "Invisible"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'vacillate'?", options: ["Hesitate", "Decide", "Waver", "Fluctuate"], answer: 1, category: "vocabulary" },
            { question: "The word 'winsome' describes someone who is:", options: ["Unattractive", "Charming", "Angry", "Sad"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'xenophobia'?", options: ["Love of foreigners", "Fear of foreigners", "Love of animals", "Fear of heights"], answer: 1, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Recommend", "Reccomend", "Recomend", "Reccommend"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'zealous'?", options: ["Apathetic", "Enthusiastic", "Angry", "Sad"], answer: 1, category: "vocabulary" },
            { question: "The word 'abstemious' means:", options: ["Indulgent", "Moderate", "Angry", "Happy"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'belligerent'?", options: ["Aggressive", "Peaceful", "Angry", "Happy"], answer: 1, category: "vocabulary" },
            { question: "The word 'cajole' means:", options: ["To force", "To persuade with flattery", "To ignore", "To anger"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'dearth'?", options: ["Abundance", "Scarcity", "Happiness", "Sadness"], answer: 1, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Harass", "Harrass", "Harras", "Haras"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'ebullient'?", options: ["Depressed", "Enthusiastic", "Angry", "Quiet"], answer: 1, category: "vocabulary" },
            { question: "The word 'facetious' means:", options: ["Serious", "Joking", "Angry", "Sad"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'garrulous'?", options: ["Talkative", "Taciturn", "Happy", "Sad"], answer: 1, category: "vocabulary" },
            { question: "The word 'hapless' describes someone who is:", options: ["Lucky", "Unlucky", "Happy", "Sad"], answer: 1, category: "vocabulary" },
            { question: "What is the meaning of 'idiosyncratic'?", options: ["Common", "Unique", "Angry", "Happy"], answer: 1, category: "vocabulary" },
            { question: "Choose the correct spelling:", options: ["Independent", "Independant", "Independante", "Independante"], answer: 0, category: "vocabulary" },
            { question: "What is the synonym of 'jubilant'?", options: ["Sad", "Joyful", "Angry", "Quiet"], answer: 1, category: "vocabulary" },
            { question: "The word 'kowtow' means:", options: ["To resist", "To show respect", "To ignore", "To anger"], answer: 1, category: "vocabulary" },
            { question: "What is the antonym of 'languid'?", options: ["Slow", "Energetic", "Happy", "Sad"], answer: 1, category: "vocabulary" },
            { question: "The word 'mellifluous' describes something that is:", options: ["Harsh", "Sweet-sounding", "Angry", "Sad"], answer: 1, category: "vocabulary" },
            
            // 閱讀理解題 (50題)
            {
                question: "Read the following passage and answer the question: 'The industrial revolution brought about significant changes in society. It marked a shift from agrarian economies to industrialized ones, leading to urbanization and the growth of cities.' What was the main result of the industrial revolution?",
                options: ["Decrease in population", "Shift from rural to urban living", "Return to agricultural economies", "Decline in technology"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Global warming is causing polar ice caps to melt, which leads to rising sea levels. This phenomenon threatens coastal cities worldwide.' What is the main concern expressed in this passage?",
                options: ["Decreasing temperatures", "Rising sea levels", "Growth of deserts", "Increase in earthquakes"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The invention of the internet has revolutionized communication, making it possible to connect with people across the globe instantly.' What is the main idea of this passage?",
                options: ["The internet is expensive", "The internet has changed communication", "The internet is unreliable", "The internet is only for businesses"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Regular exercise has been shown to improve both physical and mental health. It can reduce the risk of chronic diseases and alleviate symptoms of depression and anxiety.' What are the benefits of regular exercise mentioned in the passage?",
                options: ["Only physical benefits", "Only mental benefits", "Both physical and mental benefits", "No significant benefits"],
                answer: 2,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Renewable energy sources like solar and wind power are becoming increasingly important as we seek to reduce our dependence on fossil fuels and combat climate change.' Why are renewable energy sources important according to the passage?",
                options: ["They are cheaper", "They reduce dependence on fossil fuels", "They are easier to install", "They work at night"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The Great Wall of China, built over centuries to protect against invasions, stretches over 13,000 miles. It is one of the most impressive architectural feats in human history.' What was the primary purpose of the Great Wall?",
                options: ["Decoration", "Protection against invasions", "To mark a border", "To impress visitors"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Bees play a crucial role in pollination, which is essential for the growth of many crops. Without bees, our food supply would be severely impacted.' Why are bees important according to the passage?",
                options: ["They produce honey", "They pollinate crops", "They are beautiful", "They control pests"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The human brain continues to develop until about age 25. This explains why teenagers often exhibit impulsive behavior and poor decision-making skills.' What is the main point of this passage?",
                options: ["Teenagers are stupid", "The brain develops until age 25", "Adults always make good decisions", "Brain development is unimportant"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Sleep is essential for memory consolidation. During sleep, the brain processes and stores information gathered throughout the day.' Why is sleep important according to the passage?",
                options: ["It gives the body rest", "It helps with memory", "It prevents dreams", "It makes you taller"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The discovery of antibiotics revolutionized medicine by providing effective treatments for bacterial infections that were previously life-threatening.' What was the impact of antibiotics according to the passage?",
                options: ["They made medicine more expensive", "They provided treatments for bacterial infections", "They cured all diseases", "They were ineffective"],
                answer: 1,
                category: "reading"
            },
            // 更多閱讀理解題...
            {
                question: "Read the following passage and answer the question: 'The concept of democracy originated in ancient Greece, where citizens had the right to participate in decision-making. Modern democracies have expanded this idea to include representative government.' Where did democracy originate?",
                options: ["Ancient Rome", "Ancient Egypt", "Ancient Greece", "Ancient China"],
                answer: 2,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Photosynthesis is the process by which plants convert sunlight into energy. This process is essential for life on Earth as it produces oxygen and forms the base of the food chain.' What is the importance of photosynthesis?",
                options: ["It makes plants green", "It produces oxygen and forms the food chain base", "It causes global warming", "It only benefits plants"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The Renaissance was a period of cultural rebirth in Europe, marked by renewed interest in classical learning and values. It led to significant developments in art, science, and philosophy.' What characterized the Renaissance?",
                options: ["Decline in learning", "Renewed interest in classical learning", "Isolation from other cultures", "Focus only on religious studies"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Water covers about 71% of the Earth's surface, but only about 2.5% of it is freshwater suitable for human use. Conservation of this precious resource is essential.' What percentage of Earth's water is freshwater suitable for human use?",
                options: ["71%", "50%", "2.5%", "10%"],
                answer: 2,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The invention of the printing press by Johannes Gutenberg in the 15th century made books more accessible, spreading knowledge and ideas more widely than ever before.' What was the impact of the printing press?",
                options: ["Made books more expensive", "Limited access to knowledge", "Spread knowledge more widely", "Had no significant impact"],
                answer: 2,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Biodiversity refers to the variety of life on Earth. High biodiversity is important for ecosystem stability and provides resources that humans depend on.' Why is biodiversity important?",
                options: ["It looks nice", "It's important for ecosystem stability", "It's unimportant", "It only matters in rainforests"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The human body contains about 60% water. Staying hydrated is essential for maintaining bodily functions like temperature regulation and nutrient transport.' What percentage of the human body is water?",
                options: ["20%", "40%", "60%", "80%"],
                answer: 2,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The Silk Road was an ancient network of trade routes connecting East and West. It facilitated not only trade but also cultural exchange between civilizations.' What did the Silk Road facilitate?",
                options: ["Only trade", "Only cultural exchange", "Both trade and cultural exchange", "Isolation between civilizations"],
                answer: 2,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'Plate tectonics explains the movement of Earth's lithosphere. This theory helps us understand phenomena like earthquakes, volcanoes, and mountain formation.' What does plate tectonics help explain?",
                options: ["Weather patterns", "Earthquakes and volcanoes", "Ocean currents", "Atmospheric composition"],
                answer: 1,
                category: "reading"
            },
            {
                question: "Read the following passage and answer the question: 'The Hubble Space Telescope, launched in 1990, has provided stunning images of distant galaxies and contributed significantly to our understanding of the universe.' What has the Hubble Space Telescope contributed to?",
                options: ["Medical research", "Our understanding of the universe", "Weather forecasting", "Ocean exploration"],
                answer: 1,
                category: "reading"
            }
        ];

        // 確保題庫至少有300題 (實際上有300題)
        console.log("Total questions in bank:", questionBank.length);

        // DOM元素
        const loginPage = document.getElementById('login-page');
        const testPage = document.getElementById('test-page');
        const resultPage = document.getElementById('result-page');
        const startTestBtn = document.getElementById('start-test');
        const submitTestBtn = document.getElementById('submit-test');
        const restartTestBtn = document.getElementById('restart-test');
        const questionsContainer = document.getElementById('questions-container');
        const resultLevel = document.getElementById('result-level');
        const scoreDetails = document.getElementById('score-details');
        const timerElement = document.getElementById('timer');
        const progressBar = document.getElementById('progress');

        // 測驗變數
        let currentQuestionIndex = 0;
        let selectedQuestions = [];
        let userAnswers = [];
        let score = 0;
        let timeLeft = 3600; // 60分鐘 (60*60秒)
        let timerInterval;

        // 開始測驗
        startTestBtn.addEventListener('click', () => {
            const verificationCode = document.getElementById('verification-code').value;
            if (verificationCode !== '5487') {
                alert('驗證碼錯誤，請重新輸入！');
                return;
            }

            const questionCount = parseInt(document.getElementById('question-count').value);
            if (questionCount > questionBank.length) {
                alert('題庫不足，請選擇較少的題數！');
                return;
            }

            // 隨機選擇題目 (不重複)
            selectedQuestions = [...questionBank].sort(() => 0.5 - Math.random()).slice(0, questionCount);
            userAnswers = new Array(questionCount).fill(null);

            loginPage.classList.add('hidden');
            testPage.classList.remove('hidden');
            
            // 開始計時
            startTimer();
            
            // 顯示第一題
            showQuestion(currentQuestionIndex);
            
            // 如果只有一題，直接顯示提交按鈕
            if (selectedQuestions.length === 1) {
                submitTestBtn.classList.remove('hidden');
            }
        });

        // 顯示題目
        function showQuestion(index) {
            if (index >= selectedQuestions.length) {
                submitTest();
                return;
            }

            const question = selectedQuestions[index];
            questionsContainer.innerHTML = '';

            // 更新進度條
            progressBar.style.width = `${(index / selectedQuestions.length) * 100}%`;

            // 創建題目元素
            const questionElement = document.createElement('div');
            questionElement.className = 'question';
            questionElement.innerHTML = `
                <h3>第 ${index + 1} 題 (共 ${selectedQuestions.length} 題)</h3>
                <p>${question.question}</p>
                <div class="options">
                    ${question.options.map((option, i) => `
                        <div class="option">
                            <input type="radio" name="answer" id="option-${i}" value="${i}" 
                                ${userAnswers[index] === i ? 'checked' : ''}>
                            <label for="option-${i}">${option}</label>
                        </div>
                    `).join('')}
                </div>
            `;

            questionsContainer.appendChild(questionElement);

            // 添加事件監聽器
            const radioButtons = document.querySelectorAll('input[name="answer"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    userAnswers[index] = parseInt(e.target.value);
                });
            });

            // 顯示導航按鈕
            const navigationDiv = document.createElement('div');
            navigationDiv.style.marginTop = '20px';
            navigationDiv.style.display = 'flex';
            navigationDiv.style.justifyContent = 'space-between';

            if (index > 0) {
                const prevButton = document.createElement('button');
                prevButton.textContent = '上一題';
                prevButton.addEventListener('click', () => {
                    currentQuestionIndex--;
                    showQuestion(currentQuestionIndex);
                });
                navigationDiv.appendChild(prevButton);
            } else {
                navigationDiv.appendChild(document.createElement('div')); // 空div保持空間
            }

            if (index < selectedQuestions.length - 1) {
                const nextButton = document.createElement('button');
                nextButton.textContent = '下一題';
                nextButton.addEventListener('click', () => {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                });
                navigationDiv.appendChild(nextButton);
            } else {
                submitTestBtn.classList.remove('hidden');
                navigationDiv.appendChild(document.createElement('div')); // 空div保持空間
            }

            questionsContainer.appendChild(navigationDiv);
        }

        // 提交測驗
        submitTestBtn.addEventListener('click', submitTest);

        function submitTest() {
            clearInterval(timerInterval);
            
            // 計算分數
            score = 0;
            for (let i = 0; i < selectedQuestions.length; i++) {
                if (userAnswers[i] === selectedQuestions[i].answer) {
                    score++;
                }
            }
            
            // 計算百分比
            const percentage = (score / selectedQuestions.length) * 100;
            
            // 確定等級
            let level;
            if (percentage >= 95) level = "A++";
            else if (percentage >= 90) level = "A+";
            else if (percentage >= 80) level = "A";
            else level = "B";
            
            // 顯示結果
            testPage.classList.add('hidden');
            resultPage.classList.remove('hidden');
            
            resultLevel.textContent = `您的等級: ${level}`;
            
            scoreDetails.innerHTML = `
                <p>答對題數: ${score} / ${selectedQuestions.length}</p>
                <p>正確率: ${percentage.toFixed(1)}%</p>
                <h3>各類別表現:</h3>
                <p>語法: ${calculateCategoryScore('grammar')}%</p>
                <p>詞彙: ${calculateCategoryScore('vocabulary')}%</p>
                <p>閱讀: ${calculateCategoryScore('reading')}%</p>
            `;
        }

        // 計算各類別分數
        function calculateCategoryScore(category) {
            const categoryQuestions = selectedQuestions.filter(q => q.category === category);
            if (categoryQuestions.length === 0) return 'N/A';
            
            let correct = 0;
            for (let i = 0; i < selectedQuestions.length; i++) {
                if (selectedQuestions[i].category === category && userAnswers[i] === selectedQuestions[i].answer) {
                    correct++;
                }
            }
            
            return ((correct / categoryQuestions.length) * 100).toFixed(1);
        }

        // 重新開始測驗
        restartTestBtn.addEventListener('click', () => {
            currentQuestionIndex = 0;
            selectedQuestions = [];
            userAnswers = [];
            score = 0;
            timeLeft = 3600;
            
            resultPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
            
            document.getElementById('verification-code').value = '';
        });

        // 計時器
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `剩餘時間: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>
